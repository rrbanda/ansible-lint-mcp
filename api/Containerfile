# ── Base ─────────────────────────────────────────────────────────────────────
FROM registry.access.redhat.com/ubi9/python-39

LABEL maintainer="you@example.com"
ENV PYTHONUNBUFFERED=1 \
    PORT=8080

# ── Application setup ───────────────────────────────────────────────────────
WORKDIR /app

# 1) Install Python deps
COPY requirements.txt .
RUN pip install --no-cache-dir --upgrade pip \
    && pip install --no-cache-dir -r requirements.txt

# 2) Copy your FastAPI app
COPY main.py .

# ── OpenShift permissions ───────────────────────────────────────────────────
# Make /app owned by root:root and group-writable so any UID/GID 0 can write
RUN chown -R 0:0 /app \
    && chmod -R g+rwX /app

# ── Runtime ─────────────────────────────────────────────────────────────────
EXPOSE 8080

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8080"]
